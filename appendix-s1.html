<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>An integrated phenology modelling framework in R</title>
  <meta name="description" content="An integrated phenology modelling framework in R">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="An integrated phenology modelling framework in R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="An integrated phenology modelling framework in R" />
  
  
  

<meta name="author" content="Koen Hufkens, David Bassler, Tom milliman, Eli Melaas, Andrew D. Richardson">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="reference.html">
<link rel="next" href="appendix-s2.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Abstract</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="material-and-methods.html"><a href="material-and-methods.html"><i class="fa fa-check"></i><b>3</b> Material and Methods</a><ul>
<li class="chapter" data-level="3.1" data-path="material-and-methods.html"><a href="material-and-methods.html#the-phenor-r-package"><i class="fa fa-check"></i><b>3.1</b> The phenor R package</a></li>
<li class="chapter" data-level="3.2" data-path="material-and-methods.html"><a href="material-and-methods.html#a-worked-example-a-quick-model-comparison"><i class="fa fa-check"></i><b>3.2</b> A worked example: a quick model comparison</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>4</b> Discussion</a></li>
<li class="chapter" data-level="5" data-path="known-limitations.html"><a href="known-limitations.html"><i class="fa fa-check"></i><b>5</b> Known limitations</a></li>
<li class="chapter" data-level="6" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>6</b> Conclusion</a></li>
<li class="chapter" data-level="7" data-path="contributions.html"><a href="contributions.html"><i class="fa fa-check"></i><b>7</b> Contributions</a></li>
<li class="chapter" data-level="8" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i><b>8</b> Acknowledgements</a></li>
<li class="chapter" data-level="9" data-path="code-data-availability.html"><a href="code-data-availability.html"><i class="fa fa-check"></i><b>9</b> Code &amp; Data availability</a></li>
<li class="chapter" data-level="10" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>10</b> Reference</a></li>
<li class="chapter" data-level="11" data-path="appendix-s1.html"><a href="appendix-s1.html"><i class="fa fa-check"></i><b>11</b> APPENDIX S1</a><ul>
<li class="chapter" data-level="11.1" data-path="appendix-s1.html"><a href="appendix-s1.html#the-phenocam-network-data-processing-and-selection"><i class="fa fa-check"></i><b>11.1</b> The PhenoCam network, data processing and selection</a></li>
<li class="chapter" data-level="11.2" data-path="appendix-s1.html"><a href="appendix-s1.html#the-phenocamr-r-package-methodology"><i class="fa fa-check"></i><b>11.2</b> The phenocamr R package: methodology</a><ul>
<li class="chapter" data-level="11.2.1" data-path="appendix-s1.html"><a href="appendix-s1.html#outlier-detection-and-smoothing"><i class="fa fa-check"></i><b>11.2.1</b> Outlier detection and smoothing</a></li>
<li class="chapter" data-level="11.2.2" data-path="appendix-s1.html"><a href="appendix-s1.html#phenophase-estimation"><i class="fa fa-check"></i><b>11.2.2</b> Phenophase estimation</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="appendix-s1.html"><a href="appendix-s1.html#the-phenocamr-r-package-usage"><i class="fa fa-check"></i><b>11.3</b> The phenocamr R package: usage</a></li>
<li class="chapter" data-level="11.4" data-path="appendix-s1.html"><a href="appendix-s1.html#the-daymetr-r-package"><i class="fa fa-check"></i><b>11.4</b> The daymetr R package</a></li>
<li class="chapter" data-level="11.5" data-path="appendix-s1.html"><a href="appendix-s1.html#worked-example-statistical-results"><i class="fa fa-check"></i><b>11.5</b> Worked example statistical results</a></li>
<li class="chapter" data-level="11.6" data-path="appendix-s1.html"><a href="appendix-s1.html#references"><i class="fa fa-check"></i><b>11.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="appendix-s2.html"><a href="appendix-s2.html"><i class="fa fa-check"></i><b>12</b> APPENDIX S2</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An integrated phenology modelling framework in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="appendix-s1" class="section level1">
<h1><span class="header-section-number">11</span> APPENDIX S1</h1>
<div id="the-phenocam-network-data-processing-and-selection" class="section level2">
<h2><span class="header-section-number">11.1</span> The PhenoCam network, data processing and selection</h2>
<p>The PhenoCam network (<a href="https://phenocam.sr.unh.edu" class="uri">https://phenocam.sr.unh.edu</a>) uses digital camera imagery to monitor ecosystem dynamics over time. The network currently consists of over 400 cameras in the conterminous US, tracking vegetation development. Camera imagery is uploaded and stored on the PhenoCam server. Any new images that have been uploaded to the server during the previous 24 hours are converted into greenness time series from RGB triplets of the recorded JPEG images.</p>
<p>Variability in RGB triplets, due to changing scene illumination, can be largely suppressed by converting the DN triplets to their respective chromatic coordinates (e.g. the green chromatic coordinate, Gcc) and subsequent selection of the 90th percentile of the values across a 1 or 3-day period (Richardson et al. 2007, 2009; Sonnentag et al. 2012). Numerous studies have demonstrated the value of the Gcc index (and the corresponding red chromatic coordinate, Rcc) for characterizing the seasonal trajectory of vegetation color and activity (Keenan et al. 2014; Klosterman et al. 2014; Toomey et al. 2015). Furthermore an appropriate “region of interest” (ROI) is defined, corresponding to the area within each digital image for which colour information will be extracted according to the dominant vegetation type in each image. We therefore calculated Gcc as in eq. 1, where X DN denotes the mean (across the ROI) digital number for colour channel X. The generation of these PhenoCam Gcc 1- or 3-day summary product time series is done nightly on the PhenoCam servers.</p>
<p>Gcc = green DN / (red DN + green DN + blue DN) [eq.1]</p>
</div>
<div id="the-phenocamr-r-package-methodology" class="section level2">
<h2><span class="header-section-number">11.2</span> The phenocamr R package: methodology</h2>
<div id="outlier-detection-and-smoothing" class="section level3">
<h3><span class="header-section-number">11.2.1</span> Outlier detection and smoothing</h3>
<p>A first step in the post-processing of the PhenoCam data after downloading the data is the detection of outliers which might confound further analysis. For the outlier detection we rely on an iterative spline-based outlier detection algorithm on each of the GCC time series (mean, 50th, 75th, and 90th quantiles) included in the 1- and 3-day summary product files. First, using a range of smoothing factors, we fit a family of cubic smoothing splines to each of time series. We selected the optimal spline from within this family using Akaike’s Information Criterion (AIC, (Akaike 1974)), which balances goodness-of-fit against model complexity in order to avoid over-fitting (Hurvich et al. 1998). Then, in an iterative process, we identified and flagged data points lying more than 2x standard deviations (based on the residual variance,) from the spline. With these outliers excluded, we then repeated the spline fitting process. This was done up to 20 times or until no further outliers were detected from one iteration to the next. The spline fitting process is repeated one final time, so that together with the outlier flags, a smoothed and interpolated time series (with uncertainty estimates) could be used for transition date estimation. The procedure described above can be applied to either 1- or 3-day summary file using both the detect_outliers() and smooth_ts() routines separately. However, it is preferred to specify the proper post-processing routines upon downloading the PhenoCam data using the download_phenocam() function.</p>
</div>
<div id="phenophase-estimation" class="section level3">
<h3><span class="header-section-number">11.2.2</span> Phenophase estimation</h3>
<p>Changes in the cycle of vegetation activity are identified as change points using the Pruned Exact Linear Time (PELT) method (Killick et al. 2011) for each cycle with a penalty factor (beta = 0.5) and a minimum segment length of 14 days. Extracted phenophases are calculated as changes in the signal between these change points and intended to define the start of the “greenness rising” and end of the “greenness falling” stage for a full cycle of vegetation activity (i.e., from dormancy, through green-up or “greenness rising”, peak activity, senescence or “greenness falling”, and back to dormancy). Thus, unlike sigmoid-based approaches that have been typically used in the literature (Zhang et al. 2003; Hufkens et al. 2012; Klosterman et al. 2014; Filippa et al. 2016), our method is not limited to ecosystems with a single annual cycle of green-up and senescence and invariant to changes in baseline values due to varying camera settings over time (see Figure <a href="appendix-s1.html#fig:timeseries">11.1</a>).</p>
<p>The AIC-selected smoothing spline, described in the previous section, is central to this method. The spline is first used to determine the GCC minima (the baseline before a “greenness rising” stage or after a “greenness falling” stage) and maxima (the peak between “rising” and “falling” stages). From the GCC minima and maxima associated with each stage, we then used the spline to identify the dates when 10%, 25%, and 50% of the amplitude (= maxima – minima) were reached. Different threshold values may be specified by calling the underlying function transition_dates(). Transition date uncertainties were then derived from the confidence interval (1.96 x SE) around the smoothing spline, with a minimum uncertainty extending to the immediately preceding or following observation (i.e., ± 1 and ± 3d for the 1- and 3-day GCC time series, respectively; larger in the case of missing data on either side of the estimated transition date). By default all dates are reported in unix time with a start date at (1970-01-01).</p>
</div>
</div>
<div id="the-phenocamr-r-package-usage" class="section level2">
<h2><span class="header-section-number">11.3</span> The phenocamr R package: usage</h2>
<p>The phenocamr package, most prominently, interfaces with the PhenoCam server to facilitate easy downloading of pre-processed Gcc time series (see section 2) into the R environment. Subsequently, the package screens for outliers in the downloaded time series, smooths the time series and finally estimates different phenophases in a seamless routine. The phenocamr package currently provides all post-processing of PhenoCam standardized datasets (e.g. V1.0; Richardson et al. 2017, in press). The download_phenocam() function in the package covers most of this functionality. An example of the basic function is provided here:</p>
<pre><code>download_phenocam(site = “bartlett”,
                    vegetation = “DB”,
                    roi_id = 0003,
                    frequency = 3,
                    outlier_detection = TRUE,
                    smooth = TRUE,
                    phenophase = TRUE)</code></pre>
<p>These instruction download 3-day summary data (frequency = 3) at the Bartlett experimental forest site (site = “bartlett”) for a deciduous broadleaf (DB) ROI (vegetation = “DB”) with ID 0003 (roi_id = 0003). In addition, we specify that outlier detection and smoothing should be applied (outlier_detection, and smooth set to TRUE). Finally, phenophases are estimated for this particular time series (phenophase = TRUE). By default transition dates for the 10, 25 and 50% amplitude threshold are estimated for both rising and falling parts of a Gcc time series. A processed Gcc time series at a 3-day time step together with the 25% amplitude of the rising falling stages of each cycle of vegetation activity at the Bartlett experimental forest are shown in <a href="appendix-s1.html#fig:timeseries">11.1</a>. In the interest of brevity we refer to the package documentation for additional parameter options.</p>
<div class="figure"><span id="fig:timeseries"></span>
<img src="output/Appendix_S1_figure_1_time_series_example.png" alt="Example Gcc PhenoCam Dataset V1.0 time series" width="2100" />
<p class="caption">
Figure 11.1: Example Gcc PhenoCam Dataset V1.0 time series
</p>
</div>
</div>
<div id="the-daymetr-r-package" class="section level2">
<h2><span class="header-section-number">11.4</span> The daymetr R package</h2>
<p>Daymet provides gridded estimates of daily weather parameters across North America (Thornton et al. 1997), and makes these data available through an ORNL DAAC web service, to which the daymetr R package provides an interface. A simple download command for a particular location can be executed using the following syntax:</p>
<pre><code>download_daymet( site = &quot;bartlett&quot;,
                        lat = 44.0646,
                lon = -71.2881,
                        start = 1980,
                    end = 2010,
                        internal = TRUE)</code></pre>
<p>Here we specify the filename to assign to the data to be downloaded (e.g. “bartlett”) as specified by a given latitude and longitude and a start and end year (start = 1980 and end = 2010, respectively). The ‘internal’ parameter specifies if data should be loaded into the current R workspace (TRUE) or merely downloaded as a comma delimited file (CSV, FALSE) to disk. A similar syntax is used for batch downloading data from a list of locations stored in a CSV file using download_daymet_batch() or downloading gridded (spatial) data through the download_daymet_tiles() and download_daymet_ncss() functions.</p>
</div>
<div id="worked-example-statistical-results" class="section level2">
<h2><span class="header-section-number">11.5</span> Worked example statistical results</h2>
<p>Comparing model performance across the 20 spring phenology models and all the three PFT showed that all models were significantly different from the NULL model, except for the SGSI model for the evergreen PFT (post-hoc Tukey HSD test, p &lt; 0.001, Figure 4). We also note that the NULL model for the grassland PFT performed worse compared to either evergreen or deciduous forest PFT (Figure 4d). For grasslands the RMSE of the NULL model equals 32.7 days compared to only 14.5 and 16.1 days for the deciduous and evergreen forest sites respectively. Excluding the NULL model, model RMSE varied greatly among PFTs. For deciduous broadleaf sites an average RMSE of ~9.1 ± 1.2 days was observed (Figure 4a). For the evergreen needleleaf forest and the grassland sites the RMSE values almost doubled (~14.4 ± 0.8 days and ~13.6 ± 2 days respectively, Figure 4c-d). A separate model optimization on centrally located deciduous broadleaf sites resulted in a RMSE ~7.6 ± 0.7 days (Figure 4b). Limiting the deciduous broadleaf sites to locations to those centrally located within the biome point to a marginally higher RMSE of ~7.9 ± 1.2 days. Differences between the full deciduous broadleaf forest dataset and those more centrally within the biome allude to the influence of geographic location on model error. Although our analysis quickly and easily reproduced a limited version of previous work by Basler (2016), only including a subset of the models discussed and omitting extensive cross-validation therein, our study extends this work in other ways. Mainly, we increased the geographic range, covering boreal, temperate and subtropical regions, and included three plant functional types. However, even with this greater range in latitude and the continental scale of the study, as well as three plant functional types, does not change previous findings.</p>
<p>Variability between in RMSE between the PFT can largely be explained by differences in phenological processes. Grassland phenology is largely determined by both temperature and plant available water. Yet, two grassland spring phenology models included in phenor which account for water stress through VPD (SGSI, AGSI; Xin et al. 2015) do not perform significantly better than other described models. Heterogeneity, between grassland locations might explain this lack of performance. However, an in depth analysis is outside the scope of this manuscript. Evergreen forest phenology as observed by PhenoCams is not determined by developing leaves but by dehardening of existing needles. Estimates of evergreen phenology therefore might benefit from a model structure focussed on the dehardenning process (Hänninen &amp; Kramer 2007) not yet included in the described models.</p>
</div>
<div id="references" class="section level2">
<h2><span class="header-section-number">11.6</span> References</h2>
<p>Akaike, H. (1974). A new look at the statistical model identification. Automatic Control, IEEE Transactions on, 19, 716–723.</p>
<p>Filippa, G., Cremonese, E., Migliavacca, M., Galvagno, M., Forkel, M., Wingate, L., Tomelleri, E., Morra di Cella, U. &amp; Richardson, A.D. (2016). Phenopix: A R package for image-based vegetation phenology. Agricultural and Forest Meteorology, 220, 141–150.</p>
<p>Hufkens, K., Friedl, M., Sonnentag, O., Braswell, B.H., Milliman, T. &amp; Richardson, A.D. (2012). Linking near-surface and satellite remote sensing measurements of deciduous broadleaf forest phenology. Remote Sensing of Environment, 117, 307–321.</p>
<p>Hurvich, C.M., Simonoff, J.S. &amp; Tsai, C.-L. (1998). Smoothing parameter selection in nonparametric regression using an improved Akaike information criterion. Journal of the Royal Statistical Society: Series B (Statistical Methodology), 60, 271–293.</p>
<p>Keenan, T., Darby, B., Felts, E., Sonnentag, O., Friedl, M., Hufkens, K., O’Keefe, J., Munger, J.W., Toomey, M. &amp; Richardson, A.D. (2014). Tracking forest phenology and seasonal physiology using digital repeat photography: a critical assessment. Ecological Applications.</p>
<p>Killick, R., Fearnhead, P. &amp; Eckley, I.A. (2011). Optimal detection of changepoints with a linear computational cost. Journal of the American Statistical Association, 1459.</p>
<p>Klosterman, S.T., Hufkens, K., Gray, J.M., Melaas, E., Sonnentag, O., Lavine, I., Mitchell, L., Norman, R., Friedl, M. a. &amp; Richardson, a. D. (2014). Evaluating remote sensing of deciduous forest phenology at multiple spatial scales using PhenoCam imagery. Biogeosciences Discussions, 11, 2305–2342.</p>
<p>Melaas, E.K., Friedl, M.A. &amp; Richardson, A.D. (2016). Multiscale modeling of spring phenology across Deciduous Forests in the Eastern United States. Global Change Biology, 22, 792–805. Richardson, A.D., Braswell, B.H., Hollinger, D.Y., Jenkins, J.P. &amp; Ollinger, S. V. (2009). Near-surface remote sensing of spatial and temporal variation in canopy phenology. Ecological applications: a publication of the Ecological Society of America, 19, 1417–28.</p>
<p>Richardson, A.D., Hufkens, K., Milliman, T., Aubrecht, D.M., Chen, M., Gray, J.M., Johnston, M.R., Keenan, T.F., Klosterman, S.T., Kosmala, M., Melaas, E.K., Friedl, M.A. &amp; Frolking, S. (2017). Tracking vegetation phenology across diverse North American biomes using PhenoCam imagery. Scientific Data.</p>
<p>Richardson, A.D., Jenkins, J.P., Braswell, B.H., Hollinger, D.Y., Ollinger, S. V &amp; Smith, M.-L. (2007). Use of digital webcam images to track spring green-up in a deciduous broadleaf forest. Oecologia, 152, 323–34.</p>
<p>Sonnentag, O., Hufkens, K., Teshera-Sterne, C., Young, A.M., Friedl, M., Braswell, B.H., Milliman, T., O’Keefe, J. &amp; Richardson, A.D. (2012). Digital repeat photography for phenological research in forest ecosystems. Agricultural and Forest Meteorology, 152, 159–177.</p>
<p>Thornton, P.E., Running, S.W. &amp; White, M.A. (1997). Generating surfaces of daily meteorological variables over large regions of complex terrain. Journal of Hydrology, 190, 214–251.</p>
<p>Toomey, M., Friedl, M. a, Frolking, S., Hufkens, K., Klosterman, S., Sonnentag, O., Baldocchi, D.D., Bernacchi, C.J., Biraud, S.C. &amp; Richardson, A.D. (2015). Greenness indices from digital cameras predict the timing and seasonal dynamics of canopy-scale photosynthesis. Ecological Applications, 25, 99–115.</p>
<p>Zhang, X., Friedl, M.A., Schaaf, C.B., Strahler, A.H., Hodges, J.C.F., Gao, F., Reed, B.C. &amp; Huete, A. (2003). Monitoring vegetation phenology using MODIS. Remote Sensing of Environment, 84, 471–475.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reference.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix-s2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "twitter"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
